#!/bin/bash

set -x
set -e

echo "---> Installing application source..."

rm -fR /tmp/src/.git

mv /tmp/src/* ./

pwd

if [ -f "composer.json" ]; then
    echo "Detected composer.json, running install"
    php -dmemory_limit=${COMPOSER_MEMORY_LIMIT:--1} /usr/bin/composer install ${COMPOSER_ARGS}
    rm -rf ~/.cache/composer/
fi

if [ -z "${LARAVEL_ENV}" ]; then
    LARAVEL_ENV=prod
fi

npm install
npm run ${LARAVEL_ENV} && rm -rf ~/.npm/

